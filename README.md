# RPG Telegram Бот

RPG Telegram Бот - это текстовая ролевая игра с элементами боя и развития персонажа, реализованная в виде бота для Telegram. Игроки могут выбирать классы, повышать уровень, сражаться с монстрами, использовать уникальные способности и сохранять свой прогресс.

## Функциональность

### Основные возможности

- **Выбор класса персонажа**: Шаман, Друид, Охотник, Маг
- **Создание персонажа с пользовательским именем**: Имя должно состоять только из русских букв (заглавных или строчных)
- **Повышение уровня**: При накоплении опыта (100 ед.)
- **Боевая система**: Атака, защита, использование способностей
- **Сохранение и загрузка**: Поддержка форматов JSON и XML
- **Особое подземелье**: Доступно раз в 4 часа реального времени

### Доступные команды

- `/start` - Начало работы с ботом, приветственное сообщение и выбор класса

### Доступные действия в главном меню

- **Смена класса** - Сменить класс персонажа (недоступно во время боя)
- **Повысить уровень** - Повысить уровень персонажа при наличии достаточного опыта
- **Отправиться на охоту за монстрами** - Начать обычный бой с монстром
- **Особое подземелье** - Начать бой с сильным монстром, доступно раз в 4 часа
- **Сохранить в JSON** - Сохранить текущего персонажа в JSON-файл
- **Сохранить в XML** - Сохранить текущего персонажа в XML-файл
- **Загрузить из JSON** - Загрузить персонажа из JSON-файла
- **Загрузить из XML** - Загрузить персонажа из XML-файла

### Боевая система

После начала боя (обычного или особого подземелья) доступны следующие действия:

- **Атаковать** - Нанести урон монстру, может быть критический удар
- **Защищаться** - Попытаться уклониться от атаки монстра
- **Способности класса** - Использовать уникальные способности персонажа

### Классы персонажей

#### Шаман
- **Здоровье**: 90
- **Сила**: 10
- **Шанс крита**: 5%
- **Шанс уклонения**: 40%
- **Способность**: "Щит природы" - увеличивает шанс уклонения на 30%

#### Друид
- **Здоровье**: 70
- **Сила**: 30
- **Шанс крита**: 7%
- **Шанс уклонения**: 30%
- **Способность**: "Вызов духов" - увеличивает силу на 20%

#### Охотник
- **Здоровье**: 50
- **Сила**: 50
- **Шанс крита**: 10%
- **Шанс уклонения**: 50%
- **Способность**: "Увертливость" - увеличивает шанс уклонения на 20%

#### Маг
- **Здоровье**: 10
- **Сила**: 90
- **Шанс крита**: 20%
- **Шанс уклонения**: 20%
- **Способность**: "Огненный шар" - может нанести критический урон (увеличивает силу в 3 раза)

## Установка и запуск

### Требования

- Python 3.7+
- Библиотеки:
  - `pyTelegramBotAPI`
  - `python-dotenv`
  - `requests==2.32.5`
  - `telebot==0.0.5`

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка токена

1. Создайте файл `.env` в корне проекта
2. Добавьте в него строку с вашим токеном созданном в Bot Father:
```
API_TOKEN=ваш_токен_бота_здесь
```

### Запуск бота

Запустите файл `rpgmaker.py`:

```bash
python rpgmaker.py
```

## Архитектура проекта

```
.
├── rpgmaker.py             # Основной файл бота
├── character.py            # Базовый класс персонажа
├── shaman.py               # Класс Шаман
├── mage.py                 # Класс Маг
├── druid.py                # Класс Друид
├── hunter.py               # Класс Охотник
├── data_manager.py         # Классы для работы с JSON/XML
├── exceptions.py           # Файл с исключениями
├── tests.py                # Юнит-тесты
├── dungeon_times.txt       # Файл для хранения времени посещений подземелья
├── .env                    # Файл с токеном бота (не включается в репозиторий)
└── README.md               # Документация проекта
```

## Сохранение данных

- Персонажи сохраняются в файлы формата `character_<user_id>.json` или `character_<user_id>.xml`
- Время последнего посещения особого подземелья сохраняется в `dungeon_times.txt`

## Регулярные выражения

- `TIME_PATTERN`: Проверка формата времени `ЧЧ:ММ:СС` (например, `12:30:45`)
- `NAME_PATTERN`: Проверка имени персонажа (только русские буквы, заглавные и строчные)

## Юнит-тесты

Проект включает юнит-тесты для проверки корректности работы регулярных выражений и логики доступа к подземелью. Тесты находятся в файле `tests.py` и могут быть запущены командой:

```bash
python tests.py
```

## Особенности реализации

- Валидация имени персонажа происходит при вводе через регулярное выражение
- Временные ограничения на особое подземелье реализованы с использованием модуля `datetime`
- Система способностей реализована через словарь `abilities` в классах персонажей
- Сохранение и загрузка персонажей поддерживает все классы и сохраняет все характеристики и имя
- Токен бота загружается из файла `.env` для безопасности

## Авторы

Апресов Илья - разработчик проекта

## Лицензия

Проект распространяется под лицензией MIT.